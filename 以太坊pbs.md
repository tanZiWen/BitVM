#### PBS设计的核心机制
PBS设计将区块生成过程分为两个主要角色：提议者（Proposer）和构建者（Builder）。以下是其工作原理：
- 角色分工
- 提议者（Proposer）：
  - 由PoS验证者担任，负责从构建者提供的区块中选择一个，并将其广播到网络以达成共识。
  
  - 提议者无需自己构建完整的区块，只需根据一定的标准（如最高出价或MEV收益）从构建者提供的候选区块中选择一个。
  
  - 要求较低的计算资源，降低验证者的硬件门槛，促进去中心化。

- 构建者（Builder）：
  - 负责构建完整的区块，包括选择和排序交易以最大化收益（如通过MEV优化）。
  
  - 构建者通常是专业化的节点，具备高性能计算能力和复杂的交易排序算法。
  
  - 构建者将构建好的区块提交给提议者，并通过支付费用（通常是ETH）激励提议者选择其区块。

#### MEV-Boost 中交易的来源
MEV-Boost 是以太坊**提议者-构建者分离（PBS）**的实现，构建者（Builder）负责创建优化的区块，而验证者（Proposer）从构建者那里选择区块。交易的来源和处理方式如下：
- 以太坊内存池（Mempool）：
  - 传统交易（如用户通过钱包发送的转账或智能合约调用）仍然首先进入以太坊的公共内存池。
  
  - 构建者通过运行以太坊执行客户端（如 Geth 或 Nethermind）监听公共内存池，获取待处理的交易。
  
  - 公共内存池是去中心化的，由以太坊节点通过 P2P 网络（如 devp2p）广播交易。

- 专用交易流（Private Transaction Flows）：
  - 除了公共内存池，构建者还可以从专用交易流获取交易。例如：Flashbots Protect RPC：用户（尤其是高价值交易，如套利或清算）可以通过 Flashbots 的专用 RPC 端点直接将交易发送给构建者，绕过公共内存池。
  
  - 订单流（Order Flow）：某些 DeFi 协议或交易者通过与构建者的直接协议提交交易，以保护交易免受抢跑（frontrunning）或夹单（sandwich attacks）。
  
  - 专用交易流允许构建者访问高价值的 MEV 交易（如套利交易），这些交易可能不会进入公共内存池。

- 混合来源：
  - 构建者通常结合公共内存池和专用交易流来构建区块。公共内存池提供普通交易（如转账），而专用交易流提供高 MEV 价值的交易。
    
总结：交易并非全部直接发送给构建者，而是主要通过以太坊的公共内存池传播，构建者从中获取交易；同时，构建者可以选择性地接受专用交易流中的交易以增加 MEV 收益。

#### 收费逻辑
- 用户提交交易：
  - 用户通过钱包（如 MetaMask）发送交易到以太坊公共内存池或专用交易流（如 Flashbots Protect RPC）。
  
  - 交易指定 Gas 费用（基础费用 + 优先费），这些费用由用户支付，进入区块的交易数据。

构建者构建区块：
- 构建者从公共内存池或专用交易流收集交易，优化交易排序以提取 MEV（如通过 DeFi 套利）。

- 构建者计算区块的总价值，包括：
  -用户支付的 优先费（归提议者）。
  
  - MEV 收益（如套利利润）。

- 构建者决定一个 出价（Bid），表示愿意支付给提议者的费用（通常为 MEV 收益的一部分）。

- 构建者通过 Builder API（如 submitBlock）将区块和出价提交给中继者。

- 构建者使用复杂的算法（如 Flashbots 的 MEV-Geth）分析所有可用交易，优化交易排序以最大化收益（例如，通过套利或夹单）。

- 费用分配：
  - 用户支付：用户支付的 Gas 费用（基础费用销毁，优先费归提议者）。
  
  - 构建者支付：构建者通过区块内的转账交易（如向提议者地址发送 ETH）支付出价。
  
  - 提议者获得：
    - 用户支付的优先费（所有交易的 Tip 总和）。
    
    - 构建者的出价（MEV 收益的一部分，通常通过区块内的转账实现）。
  
  - 构建者收益：构建者保留 MEV 收益中未支付给出价的部分（例如，套利利润扣除支付给提议者的费用）。


